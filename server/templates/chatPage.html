{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
   
    <!-- Fixed Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="nav-left">
                <button id="menuToggle" class="menu-button">
                <i class="fas fa-bars" style="font-size: 24px;"></i>  
                </button>
                <h1>@{{request.user.username}}</h1>
            </div>
            <div class="nav-right">
                <button class="icon-button">
                    <i class="fas fa-bell" style="font-size: 24px;"></i>
                </button>
                <button class="icon-button">
                    <i class="fas fa-cog" style="font-size: 24px;"></i>
                </button>
                <button class="icon-button">
                    <i class="fas fa-user" style="font-size: 24px;"></i>
                </button>
                <button class="icon-button">
                    <a href="{% url 'logout' %}">Logout</a>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="layout">
        <!-- Left Menu -->
        <aside class="sidebar" id="sidebar">
            <button id="closeMenu" class="close-button">&times;</button>
            <nav class="sidebar-nav">
                
                {% for user in users %}
                    <a href="{% url 'chat' username=user.username %}" class="nav-item">@{{ user.username}}</a>                     
                {% endfor %} 
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <div class="container">
                <div class="grid">
                    <!-- Main Content Area -->
                    <div class="main-area">
                        <div class="card">
                            <h2>Welcome Back! {{request.user.first_name}}.</h2>
                            <p>Your chats will appear below.</p>

                            <!-- Chat Box Area -->
                            <div class="chat-box">
                                <!-- Chat Header -->
                                <div class="chat-header">
                                    <h3>Chatting with @{{user_obj.username}} </h3>
                                </div>
                                
                                <!-- Chat Messages Area -->
                                <div class="chat-messages" id="chatMessages">
                                    <!-- Messages will be displayed here -->
                                    {% for message in messages %}
                                        {% if message.sender == request.user %}
                                            <div class="message sent">
                                                <p>{{message.message}}</p>
                                                <small>{{message.timestamp}}</small>
                                            </div>
                                        {% else %}
                                            <div class="message received">
                                                <p>{{message.message}}</p>
                                                <small>{{message.timestamp}}</small>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>

                                <!-- New Message Input -->
                                <div class="chat-input">
                                    <input type="text" id="newMessage" placeholder="Type your message here...">
                                    <button type="submit" id="sendMessage" class="send-button">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel -->
                    <div class="right-panel">
                        <div class="sticky-content">
                            <div class="card">
                                <h3>Recent Activities</h3>
                                <div class="activity-list">
                                    <div class="activity-item">
                                        <div class="activity-dot"></div>
                                        <div class="activity-content">
                                            <p>Activity 1</p>
                                            <small>2 hours ago</small>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-dot"></div>
                                        <div class="activity-content">
                                            <p>Activity 2</p>
                                            <small>2 hours ago</small>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-dot"></div>
                                        <div class="activity-content">
                                            <p>Activity 3</p>
                                            <small>2 hours ago</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    

    {{user_obj.id | json_script:"json-username"}}
    {{request.user.username | json_script:"json-message-username"}}
    <script src="{% static 'chat.js' %}"></script>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>Dashboard</h3>
                    <p>&copy; 2024 All rights reserved</p>
                </div>
                <div class="footer-links">
                    <a href="#">Terms</a>
                    <a href="#">Privacy</a>
                    <a href="#">Contact</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="{% static 'script.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            const messageInput = document.querySelector('#newMessage');
            const sendButton = document.querySelector('#sendMessage');

            if (messageInput && sendButton) {
                console.log('Elements found');
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        console.log('Enter pressed');
                        e.preventDefault();
                        sendButton.click();
                    }
                });
            } else {
                console.log('Elements not found:', {
                    messageInput: !!messageInput,
                    sendButton: !!sendButton
                });
            }
        });
    </script>
   
</body>
</html>
